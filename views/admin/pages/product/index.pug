extends ../../layouts/default.pug
include ../../mixins/filter-status
include ../../mixins/search
include ../../mixins/pagination

block main
    h1.text-center.my-4 Product List

    .card.mb-3
        .card-header Filter and Search
        .card-body
            .row
                .col-6
                    +filter-status(filterStatus)
                .col-6
                    +search(keyword)

    // Form for batch status change
    .card.mb-3
        .card-header Status Change
        .card-body
            form(
                action=`${prefixAdmin}/products/change-multi?_method=PATCH`
                method="POST"
                id="form-change-multi"
                class="form-change-multi"
            )
                .d-flex.align-items-center.justify-content-between
                    .form-group.mr-2
                        select(name="type" class="form-control custom-select")
                            option(value="active") Active
                            option(value="inactive") Inactive
                    .form-group.mr-2
                        input(
                            type="text"
                            name="ids"
                            value=""
                            class="form-control"
                            placeholder="Enter product IDs (comma-separated)"
                        )
                    button(type="submit" class="btn btn-primary btn-apply") Apply

    //- Always display the table, regardless of whether there are results or not
    table.table.table-bordered.table-striped
        thead
            tr
                th
                    input(type="checkbox" id="checkall" name="checkall")
                th No.
                th Image
                th Title
                th Price
                th Status
                th Actions
        tbody
            if products.length > 0
                //- Loop through products and display each item
                each item, index in products
                    tr
                        td
                            input(
                                type="checkbox"
                                name="id"
                                value=`${item._id}`
                                class="checkbox-item"
                            )
                        td #{index + 1}
                        td
                            img(
                                class="item-thumbnail",
                                src=item.thumbnail,
                                alt=item.title,
                                width="100px",
                                height="auto"
                            )
                        td #{item.title}
                        td #{item.price}$
                        td
                            if item.status == "active"
                                button(
                                    data-status=item.status
                                    data-id=item.id
                                    button-change-status
                                    class="badge badge-success status-button"
                                ) Active
                            else
                                button(
                                    data-status=item.status
                                    data-id=item.id
                                    button-change-status
                                    class="badge badge-danger status-button"
                                ) Inactive
                        td
                            button(class="btn btn-warning btn-sm actions-button") Edit
                            button(class="btn btn-danger btn-sm ml-1 actions-button") Delete
            else
                //- If no products are found, display a message in a single row spanning all columns
                tr
                    td(colspan="7" class="text-center text-danger fw-bold") No results found
    +pagination(pagination)

    form(
        action=""
        method="POST"
        id="form-change-status"
        data-path=`${prefixAdmin}/products/change-status`
    )

    script(src="/admin/js/product.js")
